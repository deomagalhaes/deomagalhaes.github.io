<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo do Semáforo Maluco - Controle Inibitório</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: #f7fafc;
            padding: 15px;
            border-radius: 15px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .info-value {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .rule-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .traffic-light {
            background: #2d3748;
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            width: 200px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .light-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            border: 4px solid #4a5568;
            transition: all 0.3s ease;
            position: relative;
        }

        .light-circle.active {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255,255,255,0.5);
        }

        .response-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .response-btn {
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            min-width: 120px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .response-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn-red {
            background: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            color: white;
        }

        .btn-yellow {
            background: linear-gradient(135deg, #f6e05e 0%, #ecc94b 100%);
            color: #744210;
        }

        .btn-green {
            background: linear-gradient(135deg, #68d391 0%, #48bb78 100%);
            color: white;
        }

        .controls {
            margin-top: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2d3748;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(132, 250, 176, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .message.success {
            background: linear-gradient(135deg, #d4edc8 0%, #a8e6cf 100%);
            color: #2f855a;
        }

        .message.error {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #c53030;
        }

        .message.info {
            background: linear-gradient(135deg, #bee3f8 0%, #90cdf4 100%);
            color: #2c5282;
        }

        .instructions {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: left;
        }

        .instructions h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .instructions ul {
            color: #4a5568;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .countdown {
            font-size: 3rem;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .correct {
            animation: bounce 0.6s ease-in-out;
        }

        .wrong {
            animation: shake 0.6s ease-in-out;
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .traffic-light {
                width: 150px;
                padding: 20px;
            }
            
            .light-circle {
                width: 90px;
                height: 90px;
                font-size: 1.5rem;
            }
            
            .response-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>🚦 Semáforo Maluco</h1>
        <p class="subtitle">Teste seu controle inibitório!</p>
        
        <div class="instructions">
            <h3>📋 Como Jogar:</h3>
            <ul>
                <li>Observe a regra no topo da tela</li>
                <li>Se for "COR": clique na cor que você vê (ignore o texto)</li>
                <li>Se for "PALAVRA": clique na cor da palavra escrita (ignore a cor do fundo)</li>
                <li>Cuidado! Seu cérebro vai querer escolher automático!</li>
                <li>Seja rápido mas preciso!</li>
            </ul>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">Acertos</div>
                <div class="info-value" id="score">0</div>
            </div>
            <div class="info-item">
                <div class="info-label">Tempo</div>
                <div class="info-value" id="timeLeft">30</div>
            </div>
            <div class="info-item">
                <div class="info-label">Nível</div>
                <div class="info-value" id="level">1/10</div>
            </div>
        </div>

        <div class="rule-display" id="ruleDisplay">
            Clique em "Iniciar" para começar!
        </div>

        <div class="countdown" id="countdown" style="display: none;"></div>

        <div class="traffic-light" id="trafficLight" style="display: none;">
            <div class="light-circle active" id="lightCircle">
                VERMELHO
            </div>
        </div>

        <div class="response-buttons" id="responseButtons" style="display: none;">
            <button class="response-btn btn-red" data-color="red">🔴 VERMELHO</button>
            <button class="response-btn btn-yellow" data-color="yellow">🟡 AMARELO</button>
            <button class="response-btn btn-green" data-color="green">🟢 VERDE</button>
        </div>

        <div class="message" id="message">
            Clique em "Iniciar" para começar!
        </div>

        <div class="controls">
            <button class="btn" id="startBtn" onclick="startGame()">🎮 Iniciar</button>
            <button class="btn" id="resetBtn" onclick="resetGame()">🔄 Reiniciar</button>
        </div>
    </div>

    <script>
        const MAX_LEVEL = 10;
        const LEVEL_DURATION = 30; // segundos por nível

        let gameState = {
            level: 1,
            score: 0,
            timeLeft: LEVEL_DURATION,
            isPlaying: false,
            currentRule: 'color', // 'color' ou 'word'
            currentStimulus: null,
            timer: null,
            stimulusTimer: null,
            responseTime: 0,
            stimulusStartTime: 0
        };

        const colors = ['red', 'yellow', 'green'];
        const colorNames = {
            red: 'VERMELHO',
            yellow: 'AMARELO', 
            green: 'VERDE'
        };
        const colorStyles = {
            red: '#fc8181',
            yellow: '#f6e05e',
            green: '#68d391'
        };

        const elements = {
            ruleDisplay: document.getElementById('ruleDisplay'),
            trafficLight: document.getElementById('trafficLight'),
            lightCircle: document.getElementById('lightCircle'),
            responseButtons: document.getElementById('responseButtons'),
            message: document.getElementById('message'),
            score: document.getElementById('score'),
            timeLeft: document.getElementById('timeLeft'),
            level: document.getElementById('level'),
            startBtn: document.getElementById('startBtn'),
            resetBtn: document.getElementById('resetBtn'),
            countdown: document.getElementById('countdown')
        };

        // Sons usando Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration = 200) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        function generateStimulus() {
            const backgroundColors = [...colors];
            const textColors = [...colors];
            
            const backgroundColor = backgroundColors[Math.floor(Math.random() * backgroundColors.length)];
            const textColor = textColors[Math.floor(Math.random() * textColors.length)];
            
            // Aumentar probabilidade de conflito nos níveis mais altos
            const conflictProbability = Math.min(0.8, 0.3 + (gameState.level * 0.05));
            
            if (Math.random() > conflictProbability) {
                // Tornar congruente algumas vezes para não ser impossível
                return {
                    backgroundColor: backgroundColor,
                    textColor: backgroundColor,
                    isCongruent: true
                };
            } else {
                // Criar conflito
                let conflictColor;
                do {
                    conflictColor = textColors[Math.floor(Math.random() * textColors.length)];
                } while (conflictColor === backgroundColor);
                
                return {
                    backgroundColor: backgroundColor,
                    textColor: conflictColor,
                    isCongruent: false
                };
            }
        }

        function showStimulus() {
            if (!gameState.isPlaying) return;
            
            gameState.currentStimulus = generateStimulus();
            gameState.stimulusStartTime = Date.now();
            
            // Alternar regra a cada 3-5 estímulos
            if (Math.random() < 0.3) {
                gameState.currentRule = gameState.currentRule === 'color' ? 'word' : 'color';
            }
            
            // Atualizar display da regra
            elements.ruleDisplay.textContent = gameState.currentRule === 'color' ? 
                '🎯 REGRA: Clique na COR que você vê (ignore o texto)' : 
                '🎯 REGRA: Clique na cor da PALAVRA escrita (ignore o fundo)';
            
            // Mostrar estímulo
            elements.lightCircle.style.backgroundColor = colorStyles[gameState.currentStimulus.backgroundColor];
            elements.lightCircle.textContent = colorNames[gameState.currentStimulus.textColor];
            elements.lightCircle.style.color = gameState.currentStimulus.backgroundColor === 'yellow' ? '#744210' : 'white';
            
            // Adicionar classe de pulse para chamar atenção
            elements.lightCircle.classList.add('active');
            
            // Auto-gerar próximo estímulo após um tempo
            clearTimeout(gameState.stimulusTimer);
            gameState.stimulusTimer = setTimeout(() => {
                if (gameState.isPlaying) {
                    showStimulus();
                }
            }, 2000 + Math.random() * 2000); // 2-4 segundos
        }

        function handleResponse(selectedColor) {
            if (!gameState.isPlaying || !gameState.currentStimulus) return;
            
            gameState.responseTime = Date.now() - gameState.stimulusStartTime;
            
            let correctAnswer;
            if (gameState.currentRule === 'color') {
                correctAnswer = gameState.currentStimulus.backgroundColor;
            } else {
                correctAnswer = gameState.currentStimulus.textColor;
            }
            
            const isCorrect = selectedColor === correctAnswer;
            
            if (isCorrect) {
                gameState.score++;
                elements.score.textContent = gameState.score;
                elements.lightCircle.classList.add('correct');
                elements.message.textContent = '✅ Correto!';
                elements.message.className = 'message success';
                playSound(523, 200); // Nota C5
                
                setTimeout(() => {
                    elements.lightCircle.classList.remove('correct');
                }, 600);
            } else {
                elements.lightCircle.classList.add('wrong');
                elements.message.textContent = `❌ Erro! Era: ${colorNames[correctAnswer]}`;
                elements.message.className = 'message error';
                playSound(150, 400); // Som de erro
                
                setTimeout(() => {
                    elements.lightCircle.classList.remove('wrong');
                }, 600);
            }
            
            // Gerar próximo estímulo mais rapidamente após resposta
            clearTimeout(gameState.stimulusTimer);
            setTimeout(() => {
                if (gameState.isPlaying) {
                    showStimulus();
                }
            }, 800);
        }

        function startTimer() {
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                elements.timeLeft.textContent = gameState.timeLeft;
                
                if (gameState.timeLeft <= 0) {
                    endLevel();
                }
            }, 1000);
        }

        function endLevel() {
            gameState.isPlaying = false;
            clearInterval(gameState.timer);
            clearTimeout(gameState.stimulusTimer);
            
            elements.trafficLight.style.display = 'none';
            elements.responseButtons.style.display = 'none';
            
            const accuracy = gameState.score;
            
            if (accuracy >= 15) { // Precisou acertar pelo menos 15 para passar
                if (gameState.level < MAX_LEVEL) {
                    gameState.level++;
                    elements.level.textContent = `${gameState.level}/${MAX_LEVEL}`;
                    elements.message.textContent = `🎉 Nível ${gameState.level-1} completo! Acertos: ${accuracy}`;
                    elements.message.className = 'message success';
                    
                    setTimeout(() => {
                        elements.message.textContent = `🆙 Nível ${gameState.level}! O jogo ficou mais difícil!`;
                        elements.startBtn.textContent = '▶️ Próximo Nível';
                        elements.startBtn.disabled = false;
                    }, 2000);
                } else {
                    elements.message.textContent = `🏆 Parabéns! Você completou todos os níveis! Pontuação final: ${gameState.score}`;
                    elements.message.className = 'message success';
                    elements.startBtn.textContent = '🎮 Jogar Novamente';
                    elements.startBtn.disabled = false;
                }
            } else {
                elements.message.textContent = `😅 Que tal tentar novamente? Acertos: ${accuracy}/15 necessários`;
                elements.message.className = 'message error';
                elements.startBtn.textContent = '🔄 Tentar Novamente';
                elements.startBtn.disabled = false;
            }
        }

        function startCountdown(callback) {
            let count = 3;
            elements.countdown.style.display = 'block';
            elements.countdown.textContent = count;
            
            const countInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    elements.countdown.textContent = count;
                    playSound(400, 200);
                } else {
                    elements.countdown.textContent = 'GO!';
                    playSound(600, 300);
                    setTimeout(() => {
                        elements.countdown.style.display = 'none';
                        callback();
                    }, 500);
                    clearInterval(countInterval);
                }
            }, 1000);
        }

        function startGame() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            elements.startBtn.disabled = true;
            elements.startBtn.textContent = '🎮 Jogando...';
            
            // Reset do nível atual
            gameState.timeLeft = LEVEL_DURATION;
            gameState.isPlaying = false;
            
            elements.timeLeft.textContent = gameState.timeLeft;
            elements.message.textContent = 'Prepare-se...';
            elements.message.className = 'message info';
            
            startCountdown(() => {
                gameState.isPlaying = true;
                elements.trafficLight.style.display = 'block';
                elements.responseButtons.style.display = 'flex';
                
                startTimer();
                showStimulus();
                
                elements.message.textContent = 'Seja rápido e preciso!';
                elements.message.className = 'message info';
            });
        }

        function resetGame() {
            gameState = {
                level: 1,
                score: 0,
                timeLeft: LEVEL_DURATION,
                isPlaying: false,
                currentRule: 'color',
                currentStimulus: null,
                timer: null,
                stimulusTimer: null,
                responseTime: 0,
                stimulusStartTime: 0
            };
            
            clearInterval(gameState.timer);
            clearTimeout(gameState.stimulusTimer);
            
            elements.score.textContent = '0';
            elements.timeLeft.textContent = LEVEL_DURATION;
            elements.level.textContent = '1/10';
            elements.ruleDisplay.textContent = 'Clique em "Iniciar" para começar!';
            
            elements.message.textContent = 'Clique em "Iniciar" para começar!';
            elements.message.className = 'message';
            
            elements.startBtn.textContent = '🎮 Iniciar';
            elements.startBtn.disabled = false;
            
            elements.trafficLight.style.display = 'none';
            elements.responseButtons.style.display = 'none';
            elements.countdown.style.display = 'none';
            
            elements.lightCircle.classList.remove('correct', 'wrong', 'active');
        }

        // Event listeners para os botões de resposta
        document.querySelectorAll('.response-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const color = btn.getAttribute('data-color');
                handleResponse(color);
            });
        });

        // Inicialização
        resetGame();
    </script>
</body>
</html>